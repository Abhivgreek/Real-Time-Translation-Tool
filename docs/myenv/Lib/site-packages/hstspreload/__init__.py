"""Check if a host is in the Google Chrome HSTS Preload list"""

import functools
import os
import typing

__version__ = "2024.7.1"
__checksum__ = "d4c7163fb7a38701ff64d96701c0440385ce01ce230c48574b2b24f3b2f75c38"
__all__ = ["in_hsts_preload"]

# fmt: off
_GTLD_INCLUDE_SUBDOMAINS = {b'amazon', b'android', b'app', b'audible', b'azure', b'bank', b'bing', b'boo', b'channel', b'chrome', b'dad', b'day', b'dev', b'eat', b'esq', b'fire', b'fly', b'foo', b'gle', b'gmail', b'google', b'hangout', b'hotmail', b'imdb', b'ing', b'insurance', b'kindle', b'meet', b'meme', b'microsoft', b'mov', b'new', b'nexus', b'office', b'page', b'phd', b'play', b'prime', b'prof', b'rsvp', b'search', b'silk', b'skype', b'windows', b'xbox', b'xn--cckwcxetd', b'xn--jlq480n2rg', b'youtube', b'zappos', b'zip'}  # noqa: E501
_JUMPTABLE = [[(0, 11), (11, 5), (16, 19), (35, 55), (90, 26), (116, 12), None, (128, 19), (147, 22), (169, 7), (176, 13), (189, 18), None, (207, 29), (236, 37), (273, 19), (292, 9), (301, 36), (337, 24), (361, 10), (371, 18), None, (389, 62), (451, 8), (459, 22), (481, 19), (500, 13), (513, 14), (527, 14), None, None, (541, 40), (581, 20), (601, 25), (626, 22), (648, 22), (670, 28), None, (698, 15), (713, 25), (738, 8), (746, 13), (759, 10), None, (769, 17), (786, 6), (792, 19), (811, 16), (827, 5), (832, 19), (851, 14), (865, 11), (876, 18), (894, 27), (921, 7), (928, 11), (939, 15), (954, 12), (966, 20), (986, 8), (994, 27), (1021, 46), (1067, 25), (1092, 16), (1108, 8), (1116, 5), (1121, 22), (1143, 18), None, (1161, 36), (1197, 15), (1212, 24), (1236, 11), None, (1247, 10), (1257, 23), (1280, 18), (1298, 18), None, (1316, 20), (1336, 26), (1362, 27), (1389, 28), (1417, 20), (1437, 59), (1496, 14), (1510, 14), (1524, 8), (1532, 8), (1540, 10), (1550, 13), (1563, 20), (1583, 19), None, (1602, 13), (1615, 26), (1641, 11), (1652, 4), (1656, 22), (1678, 19), (1697, 15), (1712, 14), (1726, 28), (1754, 11), (1765, 10), (1775, 12), (1787, 25), None, (1812, 19), (1831, 14), (1845, 26), (1871, 45), (1916, 15), None, (1931, 11), (1942, 30), (1972, 21), (1993, 26), (2019, 6), (2025, 6), (2031, 14), (2045, 5), (2050, 30), (2080, 23), (2103, 6), (2109, 17), (2126, 8), (2134, 12), (2146, 12), (2158, 70), (2228, 55), (2283, 12), (2295, 23), (2318, 16), (2334, 29), (2363, 9), (2372, 24), (2396, 44), (2440, 6), (2446, 41), (2487, 22), (2509, 23), (2532, 31), (2563, 20), (2583, 8), (2591, 15), (2606, 12), (2618, 32), (2650, 25), (2675, 15), None, (2690, 46), (2736, 21), (2757, 17), (2774, 18), (2792, 26), (2818, 5), (2823, 37), (2860, 39), (2899, 16), (2915, 33), (2948, 17), (2965, 23), (2988, 21), (3009, 25), (3034, 8), (3042, 14), (3056, 7), (3063, 37), None, (3100, 18), (3118, 21), (3139, 20), (3159, 17), (3176, 24), (3200, 12), (3212, 36), (3248, 35), (3283, 12), (3295, 57), (3352, 25), (3377, 32), None, (3409, 8), (3417, 25), (3442, 18), (3460, 6), (3466, 23), None, (3489, 36), (3525, 33), (3558, 14), (3572, 16), (3588, 22), None, (3610, 30), (3640, 41), (3681, 50), (3731, 15), (3746, 20), (3766, 31), (3797, 21), (3818, 32), (3850, 24), (3874, 20), (3894, 17), (3911, 52), (3963, 6), (3969, 9), (3978, 12), (3990, 18), (4008, 11), (4019, 10), (4029, 39), (4068, 42), None, (4110, 36), (4146, 17), None, (4163, 8), (4171, 8), (4179, 7), None, (4186, 25), (4211, 17), None, (4228, 21), (4249, 35), (4284, 21), (4305, 10), (4315, 48), (4363, 11), (4374, 37), (4411, 32), (4443, 19), (4462, 12), (4474, 14), (4488, 23), (4511, 29), (4540, 14), (4554, 8), (4562, 47), (4609, 52), None, None, (4661, 47), (4708, 46), None, (4754, 18), None, (4772, 15), (4787, 8), (4795, 21), (4816, 6), (4822, 29), (4851, 22)], [(4873, 8449), (13322, 8190), (21512, 8768), (30280, 8583), (38863, 8131), (46994, 8431), (55425, 8819), (64244, 8118), (72362, 8178), (80540, 7904), (88444, 8560), (97004, 7743), (104747, 8237), (112984, 9160), (122144, 8368), (130512, 9125), (139637, 9258), (148895, 7792), (156687, 8658), (165345, 7555), (172900, 8626), (181526, 8160), (189686, 8327), (198013, 8832), (206845, 8598), (215443, 8102), (223545, 8822), (232367, 9488), (241855, 7967), (249822, 8155), (257977, 8781), (266758, 8392), (275150, 8474), (283624, 8681), (292305, 8287), (300592, 8754), (309346, 8572), (317918, 9255), (327173, 8685), (335858, 8649), (344507, 8882), (353389, 7752), (361141, 8280), (369421, 8237), (377658, 7964), (385622, 8651), (394273, 8000), (402273, 9512), (411785, 8238), (420023, 7857), (427880, 8375), (436255, 8009), (444264, 8379), (452643, 8453), (461096, 8141), (469237, 8382), (477619, 8358), (485977, 8667), (494644, 8529), (503173, 7243), (510416, 7768), (518184, 8778), (526962, 8426), (535388, 8744), (544132, 9220), (553352, 8011), (561363, 8353), (569716, 8837), (578553, 9236), (587789, 8171), (595960, 7823), (603783, 7889), (611672, 7640), (619312, 8961), (628273, 8013), (636286, 8703), (644989, 8030), (653019, 9347), (662366, 8426), (670792, 8381), (679173, 8379), (687552, 7764), (695316, 8123), (703439, 8521), (711960, 8461), (720421, 8730), (729151, 8945), (738096, 8208), (746304, 7707), (754011, 8344), (762355, 9660), (772015, 8594), (780609, 8005), (788614, 8466), (797080, 8304), (805384, 8410), (813794, 8472), (822266, 7678), (829944, 8514), (838458, 7784), (846242, 8248), (854490, 8000), (862490, 8221), (870711, 7960), (878671, 8167), (886838, 8999), (895837, 8545), (904382, 8691), (913073, 8105), (921178, 8119), (929297, 8994), (938291, 8389), (946680, 7692), (954372, 7864), (962236, 8359), (970595, 8285), (978880, 8515), (987395, 8836), (996231, 8410), (1004641, 8342), (1012983, 8439), (1021422, 8377), (1029799, 7928), (1037727, 8539), (1046266, 8839), (1055105, 7950), (1063055, 8196), (1071251, 9151), (1080402, 8113), (1088515, 9449), (1097964, 9204), (1107168, 8263), (1115431, 7985), (1123416, 7634), (1131050, 8062), (1139112, 9000), (1148112, 9093), (1157205, 9560), (1166765, 8648), (1175413, 8892), (1184305, 9341), (1193646, 8738), (1202384, 8279), (1210663, 8478), (1219141, 9131), (1228272, 7498), (1235770, 8499), (1244269, 8164), (1252433, 8313), (1260746, 8322), (1269068, 8436), (1277504, 8567), (1286071, 8419), (1294490, 7859), (1302349, 8035), (1310384, 8602), (1318986, 8524), (1327510, 8511), (1336021, 8031), (1344052, 7819), (1351871, 7961), (1359832, 8454), (1368286, 8468), (1376754, 8078), (1384832, 8566), (1393398, 9047), (1402445, 9069), (1411514, 7837), (1419351, 9565), (1428916, 8436), (1437352, 8192), (1445544, 8302), (1453846, 9075), (1462921, 7885), (1470806, 8035), (1478841, 8451), (1487292, 8879), (1496171, 8991), (1505162, 7959), (1513121, 7813), (1520934, 10376), (1531310, 8972), (1540282, 7985), (1548267, 8219), (1556486, 8627), (1565113, 8752), (1573865, 7768), (1581633, 9103), (1590736, 8258), (1598994, 8524), (1607518, 8316), (1615834, 7996), (1623830, 8197), (1632027, 7527), (1639554, 8333), (1647887, 7596), (1655483, 7585), (1663068, 7870), (1670938, 8139), (1679077, 8821), (1687898, 8457), (1696355, 8544), (1704899, 8827), (1713726, 7588), (1721314, 8751), (1730065, 8963), (1739028, 7865), (1746893, 8578), (1755471, 9375), (1764846, 7884), (1772730, 9265), (1781995, 8602), (1790597, 8102), (1798699, 8339), (1807038, 8560), (1815598, 8561), (1824159, 8256), (1832415, 8486), (1840901, 8226), (1849127, 9011), (1858138, 8271), (1866409, 7811), (1874220, 8922), (1883142, 8406), (1891548, 8573), (1900121, 8114), (1908235, 9164), (1917399, 8793), (1926192, 8661), (1934853, 9118), (1943971, 8996), (1952967, 8344), (1961311, 8223), (1969534, 8681), (1978215, 8203), (1986418, 9245), (1995663, 8341), (2004004, 7801), (2011805, 7870), (2019675, 8802), (2028477, 8915), (2037392, 8624), (2046016, 8674), (2054690, 8647), (2063337, 8017), (2071354, 9071), (2080425, 8520), (2088945, 8315), (2097260, 8477), (2105737, 7557), (2113294, 8347), (2121641, 8353), (2129994, 8160), (2138154, 8010), (2146164, 8268), (2154432, 8649)], [(2163081, 910), (2163991, 756), (2164747, 862), (2165609, 794), (2166403, 915), (2167318, 769), (2168087, 638), (2168725, 913), (2169638, 640), (2170278, 839), (2171117, 454), (2171571, 624), (2172195, 889), (2173084, 989), (2174073, 818), (2174891, 629), (2175520, 1267), (2176787, 755), (2177542, 730), (2178272, 848), (2179120, 1107), (2180227, 764), (2180991, 739), (2181730, 654), (2182384, 732), (2183116, 695), (2183811, 909), (2184720, 1331), (2186051, 739), (2186790, 760), (2187550, 811), (2188361, 722), (2189083, 759), (2189842, 786), (2190628, 1015), (2191643, 986), (2192629, 561), (2193190, 833), (2194023, 766), (2194789, 927), (2195716, 812), (2196528, 744), (2197272, 697), (2197969, 807), (2198776, 720), (2199496, 795), (2200291, 670), (2200961, 774), (2201735, 781), (2202516, 518), (2203034, 740), (2203774, 767), (2204541, 820), (2205361, 807), (2206168, 1315), (2207483, 686), (2208169, 862), (2209031, 746), (2209777, 570), (2210347, 672), (2211019, 791), (2211810, 863), (2212673, 971), (2213644, 849), (2214493, 673), (2215166, 775), (2215941, 921), (2216862, 678), (2217540, 599), (2218139, 1016), (2219155, 759), (2219914, 710), (2220624, 433), (2221057, 777), (2221834, 431), (2222265, 767), (2223032, 623), (2223655, 939), (2224594, 881), (2225475, 604), (2226079, 829), (2226908, 782), (2227690, 925), (2228615, 741), (2229356, 876), (2230232, 809), (2231041, 741), (2231782, 606), (2232388, 889), (2233277, 944), (2234221, 1130), (2235351, 1115), (2236466, 964), (2237430, 775), (2238205, 712), (2238917, 552), (2239469, 978), (2240447, 797), (2241244, 774), (2242018, 673), (2242691, 801), (2243492, 774), (2244266, 794), (2245060, 534), (2245594, 799), (2246393, 927), (2247320, 652), (2247972, 571), (2248543, 812), (2249355, 931), (2250286, 766), (2251052, 980), (2252032, 1077), (2253109, 695), (2253804, 687), (2254491, 716), (2255207, 759), (2255966, 908), (2256874, 662), (2257536, 736), (2258272, 1097), (2259369, 759), (2260128, 871), (2260999, 823), (2261822, 787), (2262609, 745), (2263354, 848), (2264202, 834), (2265036, 618), (2265654, 943), (2266597, 668), (2267265, 900), (2268165, 693), (2268858, 670), (2269528, 631), (2270159, 910), (2271069, 876), (2271945, 682), (2272627, 628), (2273255, 841), (2274096, 802), (2274898, 716), (2275614, 642), (2276256, 590), (2276846, 783), (2277629, 537), (2278166, 817), (2278983, 637), (2279620, 832), (2280452, 595), (2281047, 822), (2281869, 626), (2282495, 794), (2283289, 897), (2284186, 1031), (2285217, 828), (2286045, 822), (2286867, 1032), (2287899, 877), (2288776, 763), (2289539, 990), (2290529, 673), (2291202, 879), (2292081, 900), (2292981, 1020), (2294001, 1061), (2295062, 619), (2295681, 934), (2296615, 729), (2297344, 651), (2297995, 734), (2298729, 499), (2299228, 1107), (2300335, 591), (2300926, 979), (2301905, 833), (2302738, 906), (2303644, 746), (2304390, 588), (2304978, 724), (2305702, 1893), (2307595, 786), (2308381, 767), (2309148, 829), (2309977, 996), (2310973, 632), (2311605, 915), (2312520, 883), (2313403, 589), (2313992, 951), (2314943, 667), (2315610, 620), (2316230, 559), (2316789, 1154), (2317943, 755), (2318698, 742), (2319440, 603), (2320043, 698), (2320741, 954), (2321695, 851), (2322546, 836), (2323382, 774), (2324156, 853), (2325009, 663), (2325672, 665), (2326337, 607), (2326944, 739), (2327683, 1031), (2328714, 912), (2329626, 686), (2330312, 792), (2331104, 743), (2331847, 836), (2332683, 1149), (2333832, 517), (2334349, 825), (2335174, 798), (2335972, 770), (2336742, 734), (2337476, 609), (2338085, 653), (2338738, 812), (2339550, 831), (2340381, 1011), (2341392, 534), (2341926, 648), (2342574, 754), (2343328, 721), (2344049, 756), (2344805, 804), (2345609, 919), (2346528, 512), (2347040, 1024), (2348064, 646), (2348710, 685), (2349395, 708), (2350103, 865), (2350968, 607), (2351575, 847), (2352422, 876), (2353298, 821), (2354119, 511), (2354630, 851), (2355481, 521), (2356002, 874), (2356876, 557), (2357433, 730), (2358163, 871), (2359034, 650), (2359684, 886), (2360570, 2336), (2362906, 671), (2363577, 888), (2364465, 821), (2365286, 849), (2366135, 699)], [(2366834, 48), None, None, (2366882, 42), None, (2366924, 27), (2366951, 43), None, None, None, None, None, None, None, (2366994, 21), None, None, (2367015, 42), None, (2367057, 25), (2367082, 44), None, (2367126, 49), None, None, (2367175, 23), None, None, None, None, None, None, (2367198, 21), (2367219, 46), None, None, (2367265, 44), None, None, None, None, (2367309, 44), (2367353, 21), (2367374, 23), None, None, None, None, (2367397, 42), None, None, None, None, None, (2367439, 31), None, None, None, None, (2367470, 42), (2367512, 19), None, None, (2367531, 21), None, (2367552, 26), (2367578, 56), None, (2367634, 16), (2367650, 42), (2367692, 27), None, None, None, None, (2367719, 21), (2367740, 52), None, (2367792, 17), (2367809, 20), (2367829, 42), None, None, None, (2367871, 25), (2367896, 17), (2367913, 27), (2367940, 21), None, None, None, (2367961, 24), None, (2367985, 24), (2368009, 21), (2368030, 24), None, (2368054, 48), None, None, (2368102, 17), (2368119, 19), None, None, None, None, (2368138, 31), None, None, None, None, None, None, (2368169, 28), None, (2368197, 64), (2368261, 42), (2368303, 17), (2368320, 17), (2368337, 26), None, (2368363, 19), None, None, None, None, (2368382, 20), None, None, (2368402, 42), (2368444, 63), (2368507, 17), None, None, (2368524, 21), None, None, None, None, (2368545, 21), (2368566, 16), None, (2368582, 31), None, None, None, None, (2368613, 42), None, (2368655, 80), None, (2368735, 9), None, (2368744, 21), (2368765, 42), None, (2368807, 18), (2368825, 90), (2368915, 56), (2368971, 45), None, (2369016, 42), None, None, (2369058, 24), (2369082, 21), None, None, None, None, None, (2369103, 42), (2369145, 21), (2369166, 21), None, (2369187, 42), (2369229, 25), None, (2369254, 55), (2369309, 21), (2369330, 56), None, None, (2369386, 36), (2369422, 16), None, None, (2369438, 16), None, (2369454, 35), None, None, (2369489, 21), None, (2369510, 22), (2369532, 21), (2369553, 21), (2369574, 21), None, (2369595, 63), (2369658, 41), (2369699, 21), (2369720, 42), None, None, None, None, None, (2369762, 15), (2369777, 21), (2369798, 21), None, None, (2369819, 21), None, None, (2369840, 21), None, None, (2369861, 19), (2369880, 66), None, None, None, (2369946, 50), None, (2369996, 21), (2370017, 21), (2370038, 19), None, (2370057, 16), (2370073, 26), None, (2370099, 58), (2370157, 42), None, None, None, None, None, None, (2370199, 21), None, None, None, (2370220, 21), None, None, (2370241, 64), None, (2370305, 254), (2370559, 21), (2370580, 24), None, (2370604, 21), (2370625, 14)], [None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, (2370639, 62), None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]]  # noqa: E501
_CRC8_TABLE = [
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15,
    0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65,
    0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5,
    0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,
    0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85,
    0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,
    0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2,
    0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,
    0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2,
    0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,
    0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,
    0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42,
    0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,
    0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c,
    0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,
    0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec,
    0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,
    0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c,
    0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,
    0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c,
    0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,
    0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b,
    0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b,
    0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,
    0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb,
    0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,
    0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb,
    0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3
]
# fmt: on

_IS_LEAF = 0x80
_INCLUDE_SUBDOMAINS = 0x40


try:
    from importlib.resources import open_binary

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open_binary("hstspreload", path)


except ImportError:

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open(
            os.path.join(os.path.dirname(os.path.abspath(__file__)), path),
            "rb",
        )


@functools.lru_cache(maxsize=1024)
def in_hsts_preload(host: typing.AnyStr) -> bool:
    """Determines if an IDNA-encoded host is on the HSTS preload list"""

    if isinstance(host, str):
        host = host.encode("ascii")
    labels = host.lower().split(b".")

    # Fast-branch for gTLDs that are registered to preload all sub-domains.
    if labels[-1] in _GTLD_INCLUDE_SUBDOMAINS:
        return True

    with open_pkg_binary("hstspreload.bin") as f:
        for layer, label in enumerate(labels[::-1]):
            # None of our layers are greater than 5 deep.
            if layer > 4:
                return False

            # Read the jump table for the layer and label
            jump_info = _JUMPTABLE[layer][_crc8(label)]
            if jump_info is None:
                # No entry: host is not preloaded
                return False

            # Read the set of entries for that layer and label
            f.seek(jump_info[0])
            data = bytearray(jump_info[1])
            f.readinto(data)

            for is_leaf, include_subdomains, ent_label in _iter_entries(data):
                # We found a potential leaf
                if is_leaf:
                    if ent_label == host:
                        return True
                    if include_subdomains and host.endswith(b"." + ent_label):
                        return True

                # Continue traversing as we're not at a leaf.
                elif label == ent_label:
                    break
            else:
                return False
    return False


def _iter_entries(data: bytes) -> typing.Iterable[typing.Tuple[int, int, bytes]]:
    while data:
        flags = data[0]
        size = data[1]
        label = bytes(data[2 : 2 + size])
        yield (flags & _IS_LEAF, flags & _INCLUDE_SUBDOMAINS, label)
        data = data[2 + size :]


def _crc8(value: bytes) -> int:
    # CRC8 reference implementation: https://github.com/niccokunzmann/crc8
    checksum = 0x00
    for byte in value:
        checksum = _CRC8_TABLE[checksum ^ byte]
    return checksum
